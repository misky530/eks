# MQTT-Kafka Bridge æ¶æ„è®¾è®¡

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å¤–éƒ¨ MQTT Broker                         â”‚
â”‚                     tcp://hats.hcs.cn:1883                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ Subscribe
                             â”‚ mtic/msg/client/realtime/tenant123/#
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EKS Cluster                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Namespace: iot-bridge                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         Pod: mqtt-kafka-bridge                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Container: bridge (Go Binary)              â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                               â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ CPU Request: 50m (0.05 cores)            â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Memory Request: 64Mi                      â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Image Size: ~18MB                         â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚                                               â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  Flow:                                        â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  1. è¿æ¥ MQTT Broker                         â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  2. è®¢é˜…é€šé…ç¬¦ Topic                         â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  3. æ¥æ”¶æ¶ˆæ¯                                  â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  4. è§£æ tenantId/projectId                  â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  5. å†™å…¥åŠ¨æ€ Kafka Topic                     â”‚    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                             â”‚                                    â”‚
â”‚                             â”‚ Produce                            â”‚
â”‚                             â”‚ kafka://iot-cluster:9092           â”‚
â”‚                             â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Namespace: kafka                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         Kafka Cluster: iot-cluster                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Topics:                                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ tenant123.project001                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ tenant123.project002                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ tenant123.project003                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ ... (åŠ¨æ€åˆ›å»º)                                    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Namespace: argocd                            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         ArgoCD Application Controller               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ ç›‘å¬ Git Repository                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ è‡ªåŠ¨åŒæ­¥ Kubernetes èµ„æº                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ è‡ªæˆ‘ä¿®å¤ (Self-Heal)                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ¶ˆæ¯æµ

### 1. MQTT è®¢é˜…

```
MQTT Topic Pattern: mtic/msg/client/realtime/tenant123/#

å®é™…è®¢é˜…çš„ Topics:
â”œâ”€â”€ mtic/msg/client/realtime/tenant123/project001
â”œâ”€â”€ mtic/msg/client/realtime/tenant123/project002
â”œâ”€â”€ mtic/msg/client/realtime/tenant123/project003
â””â”€â”€ ... (æ‰€æœ‰ tenant123 ä¸‹çš„é¡¹ç›®)
```

### 2. Topic è§£æ

```go
// è¾“å…¥ MQTT Topic
mqtt_topic = "mtic/msg/client/realtime/tenant123/project456"

// è§£æè·¯å¾„
parts = strings.Split(mqtt_topic, "/")
// parts = ["mtic", "msg", "client", "realtime", "tenant123", "project456"]

tenantId  = parts[4]  // "tenant123"
projectId = parts[5]  // "project456"

// æ„é€  Kafka Topic
kafka_topic = tenantId + "." + projectId  // "tenant123.project456"
```

### 3. Kafka å†™å…¥

```go
kafka.Message{
    Topic: "tenant123.project456",      // åŠ¨æ€ Topic
    Key:   []byte("project456"),        // é¡¹ç›® ID ä½œä¸º Key (åˆ†åŒºç­–ç•¥)
    Value: mqtt_message_payload,        // åŸå§‹ JSON (ä¸ä¿®æ”¹)
}
```

### 4. æ¶ˆæ¯ç¤ºä¾‹

```json
// MQTT æ¶ˆæ¯ (åŸå§‹)
{
  "deviceId": "sensor-001",
  "timestamp": 1732715160,
  "temperature": 25.3,
  "humidity": 65.2
}

// Kafka æ¶ˆæ¯ (åŸæ ·è½¬å‘)
Topic: tenant123.project456
Key: project456
Value: {
  "deviceId": "sensor-001",
  "timestamp": 1732715160,
  "temperature": 25.3,
  "humidity": 65.2
}
```

## èµ„æºåˆ†é…ç­–ç•¥

### ä¸ºä»€ä¹ˆé€‰æ‹©è¿™äº›èµ„æºé™åˆ¶ï¼Ÿ

#### CPU: 50m Request / 200m Limit

```
é¢„ä¼°è®¡ç®—ï¼š
â€¢ MQTT è¿æ¥ç»´æŠ¤: ~5m CPU
â€¢ æ¶ˆæ¯è§£æ (æ¯ç§’ 100 æ¡): ~20m CPU
â€¢ Kafka å†™å…¥ (æ‰¹é‡): ~15m CPU
â€¢ æ—¥å¿—è¾“å‡º: ~5m CPU
â€¢ Go Runtime å¼€é”€: ~5m CPU
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡: ~50m CPU (æ­£å¸¸è´Ÿè½½)

Burst åœºæ™¯ (æ¯ç§’ 500 æ¡æ¶ˆæ¯):
â€¢ æ¶ˆæ¯è§£æ: ~80m CPU
â€¢ Kafka å†™å…¥: ~60m CPU
â€¢ å…¶ä»–: ~10m CPU
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
å³°å€¼: ~150m CPU (ç•™ 50m ä½™é‡)
```

#### Memory: 64Mi Request / 128Mi Limit

```
Go åº”ç”¨å†…å­˜å ç”¨ï¼š
â€¢ äºŒè¿›åˆ¶æ–‡ä»¶: ~10MB (é™æ€é“¾æ¥)
â€¢ Go Runtime: ~8MB
â€¢ MQTT å®¢æˆ·ç«¯è¿æ¥: ~2MB
â€¢ Kafka Writer ç¼“å†²: ~10MB (10ms batch)
â€¢ æ¶ˆæ¯ç¼“å†² (100 æ¡ x 5KB): ~0.5MB
â€¢ æ—¥å¿—ç¼“å†²: ~1MB
â€¢ å…¶ä»–æ•°æ®ç»“æ„: ~5MB
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡: ~36MB (å®é™…è¿è¡Œ)

Limit 128Mi æ˜¯ä¸ºäº†ï¼š
â€¢ åº”å¯¹æµé‡çªå‘
â€¢ GC å‹åŠ›ç¼“å†²
â€¢ é¿å… OOM Kill
```

### ä¸ä½ å½“å‰ç¯å¢ƒçš„é€‚é…

```
å½“å‰çº¦æŸ:
â€¢ t3.small èŠ‚ç‚¹: 2 vCPU / 2GB RAM
â€¢ æ¯èŠ‚ç‚¹æœ€å¤š 11 ä¸ª Pod
â€¢ vCPU é…é¢å·²ç”¨å®Œ (8/8)

Bridge å ç”¨:
â€¢ 0.05 CPU (0.625% å•èŠ‚ç‚¹)
â€¢ 64Mi Memory (3.1% å•èŠ‚ç‚¹)

ç»“è®º: âœ… èµ„æºå ç”¨æå°ï¼Œä¸ä¼šåŠ é‡è´Ÿæ‹…
```

## å®¹é”™è®¾è®¡

### 1. MQTT è‡ªåŠ¨é‡è¿

```go
opts := mqtt.NewClientOptions().
    SetAutoReconnect(true).                 // è‡ªåŠ¨é‡è¿
    SetMaxReconnectInterval(10 * time.Second). // æœ€å¤§é‡è¿é—´éš”
    SetKeepAlive(60 * time.Second).         // å¿ƒè·³
    SetConnectionLostHandler(onLost)        // è¿æ¥ä¸¢å¤±å›è°ƒ
```

**åœºæ™¯**: MQTT Broker é‡å¯æˆ–ç½‘ç»œä¸­æ–­
**è¡Œä¸º**: è‡ªåŠ¨é‡è¿ï¼Œä¸ä¸¢å¤±è®¢é˜…

### 2. Kafka é‡è¯•æœºåˆ¶

```go
kafkaWriter := &kafka.Writer{
    RequiredAcks: kafka.RequireOne,  // è‡³å°‘ 1 ä¸ª Broker ç¡®è®¤
    WriteTimeout: 10 * time.Second,  // å†™å…¥è¶…æ—¶
    BatchTimeout: 10 * time.Millisecond, // æ‰¹é‡å»¶è¿Ÿ
}
```

**åœºæ™¯**: Kafka çŸ­æš‚ä¸å¯ç”¨
**è¡Œä¸º**: 10 ç§’å†…é‡è¯•ï¼Œå¤±è´¥è®°å½•æ—¥å¿—

### 3. Kubernetes è‡ªæ„ˆ

```yaml
livenessProbe:
  exec:
    command: [pgrep, bridge]
  initialDelaySeconds: 10
  periodSeconds: 30
```

**åœºæ™¯**: è¿›ç¨‹å´©æºƒæˆ–æ­»é”
**è¡Œä¸º**: 30 ç§’æ£€æµ‹ä¸€æ¬¡ï¼Œå¤±è´¥åé‡å¯ Pod

### 4. ä¼˜é›…å…³é—­

```go
sigChan := make(chan os.Signal, 1)
signal.Notify(sigChan, SIGINT, SIGTERM)
<-sigChan

// 1. æ–­å¼€ MQTT (250ms)
mqttClient.Disconnect(250)

// 2. å…³é—­ Kafka Writer (5s timeout)
ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)
kafkaWriter.Close()
```

**åœºæ™¯**: Pod æ»šåŠ¨æ›´æ–°æˆ–åˆ é™¤
**è¡Œä¸º**: 30 ç§’å†…å®Œæˆæ¸…ç†ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±

## æ€§èƒ½ä¼°ç®—

### ååé‡æµ‹è¯•

```
å• Pod æ€§èƒ½:
â€¢ MQTT æ¥æ”¶: ~1000 msg/s
â€¢ Kafka å†™å…¥ (æ‰¹é‡): ~800 msg/s
â€¢ ç“¶é¢ˆ: ç½‘ç»œå»¶è¿Ÿ (å¤–ç½‘ MQTT)

èµ„æºå ç”¨ (1000 msg/s):
â€¢ CPU: ~150m
â€¢ Memory: ~80Mi
â€¢ Network In: ~5 Mbps (5KB/msg)
â€¢ Network Out: ~5 Mbps (å†™å…¥ Kafka)
```

### æ‰©å±•æ€§

```
éœ€æ±‚: 5000 msg/s

æ–¹æ¡ˆ 1: å‚ç›´æ‰©å±• (å• Pod)
â€¢ CPU: 300m
â€¢ Memory: 256Mi
â€¢ é£é™©: å•ç‚¹æ•…éšœ

æ–¹æ¡ˆ 2: æ°´å¹³æ‰©å±• (å¤šå‰¯æœ¬) âœ… æ¨è
â€¢ Replicas: 3
â€¢ æ¯ä¸ª Pod: 50m CPU / 64Mi Memory
â€¢ ä¼˜åŠ¿: é«˜å¯ç”¨ + è´Ÿè½½å‡è¡¡
â€¢ æ³¨æ„: MQTT å®¢æˆ·ç«¯ ID ä¸èƒ½é‡å¤ (å·²è§£å†³)
```

## ç›‘æ§æŒ‡æ ‡ (æœªæ¥æ‰©å±•)

### åº”ç”¨æŒ‡æ ‡

```go
// å¯æ·»åŠ çš„ Prometheus æŒ‡æ ‡
var (
    mqttMessagesReceived = prometheus.NewCounter(...)
    mqttConnectionStatus = prometheus.NewGauge(...)
    kafkaMessagesProduced = prometheus.NewCounter(...)
    kafkaWriteLatency = prometheus.NewHistogram(...)
    messageProcessingErrors = prometheus.NewCounter(...)
)
```

### æŸ¥è¯¢ç¤ºä¾‹

```promql
# æ¶ˆæ¯æ¥æ”¶é€Ÿç‡
rate(mqtt_messages_received_total[5m])

# Kafka å†™å…¥å»¶è¿Ÿ P95
histogram_quantile(0.95, kafka_write_latency_seconds)

# é”™è¯¯ç‡
rate(message_processing_errors_total[5m])
```

## å®‰å…¨è€ƒè™‘

### 1. é Root ç”¨æˆ·

```dockerfile
RUN adduser -D -u 1000 bridge
USER bridge
```

### 2. åªè¯»æ–‡ä»¶ç³»ç»Ÿ

```yaml
securityContext:
  readOnlyRootFilesystem: true
```

### 3. æœ€å°æƒé™

```yaml
capabilities:
  drop:
  - ALL  # ç§»é™¤æ‰€æœ‰ Linux Capabilities
```

### 4. ç½‘ç»œéš”ç¦»

```
â€¢ MQTT: ä»…å…è®¸å‡ºç«™åˆ° hats.hcs.cn:1883
â€¢ Kafka: ä»…é›†ç¾¤å†…é€šä¿¡ (ClusterIP)
â€¢ æ— éœ€ Ingress (ä¸å¯¹å¤–æš´éœ²)
```

## æ•…éšœåœºæ™¯åˆ†æ

| æ•…éšœåœºæ™¯ | å½±å“ | æ¢å¤æœºåˆ¶ | RTO |
|---------|------|---------|-----|
| MQTT Broker é‡å¯ | æ¶ˆæ¯æš‚æ—¶æ— æ³•æ¥æ”¶ | è‡ªåŠ¨é‡è¿ | < 10s |
| Kafka é›†ç¾¤æ•…éšœ | æ¶ˆæ¯å†™å…¥å¤±è´¥ | é‡è¯• 10sï¼Œå¤±è´¥è®°å½•æ—¥å¿— | ä¾èµ– Kafka |
| Pod å´©æºƒ | å•å‰¯æœ¬æ—¶æ¶ˆæ¯ä¸¢å¤± | Kubernetes é‡å¯ Pod | < 30s |
| èŠ‚ç‚¹æ•…éšœ | Pod é‡æ–°è°ƒåº¦ | Kubernetes è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ | < 2min |
| æµé‡çªå‘ | CPU/Memory å‹åŠ› | èµ„æº Limit ä¿æŠ¤ | é™çº§ä¸å½±å“å…¶ä»– Pod |

## ä¼˜åŒ–å»ºè®®

### çŸ­æœŸ (å½“å‰éƒ¨ç½²)
âœ… å·²å®ç°æœ€ä¼˜é…ç½®

### ä¸­æœŸ (1-3 ä¸ªæœˆ)
- [ ] æ·»åŠ  Prometheus ç›‘æ§
- [ ] é…ç½® HPA (åŸºäº CPU è‡ªåŠ¨æ‰©ç¼©å®¹)
- [ ] Kafka Topic é¢„åˆ›å»ºè„šæœ¬è‡ªåŠ¨åŒ–

### é•¿æœŸ (3-6 ä¸ªæœˆ)
- [ ] æ”¯æŒå¤šä¸ª MQTT Broker (ä¸»å¤‡)
- [ ] æ¶ˆæ¯å»é‡ (åŸºäº messageId)
- [ ] æ­»ä¿¡é˜Ÿåˆ— (DLQ) å¤„ç†å¤±è´¥æ¶ˆæ¯
- [ ] Grafana Dashboard

## æ€»ç»“

è¿™ä¸ª Bridge åº”ç”¨è®¾è®¡çš„æ ¸å¿ƒæ€æƒ³ï¼š

1. **æç®€**: åªåšä¸€ä»¶äº‹ - MQTT â†’ Kafka è½¬å‘
2. **è½»é‡**: èµ„æºå ç”¨æœ€å°ï¼Œé€‚åˆèµ„æºå—é™ç¯å¢ƒ
3. **å¯é **: è‡ªåŠ¨é‡è¿ã€ä¼˜é›…å…³é—­ã€å®¹é”™è®¾è®¡
4. **å¯è§‚æµ‹**: ç»“æ„åŒ–æ—¥å¿—ï¼Œæ˜“äºè°ƒè¯•
5. **äº‘åŸç”Ÿ**: éµå¾ª 12-Factorï¼ŒKubernetes å‹å¥½

é€‚åˆä½ å½“å‰çš„å­¦ä¹ åœºæ™¯å’Œèµ„æºçº¦æŸï¼ğŸ¯
